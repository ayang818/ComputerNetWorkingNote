# UDP(User Datagram Protocal)
- 基于Internet IP协议——端到端
    - 复用/分用
    - 简单的错误校验
        - 为什么要在传输层做错误检测——端到端原则，多个路由器，多个链路。

- 基本相当于把网络层暴露给了运输层，尽力而为服务
    - 丢失
    - 非排序到达

## 无连接
- UDP发送方与接收方直接不需要握手
- 每个UDP段的处理独立于其他段，互相之间独立

## UDP为什么存在
1. 无需建立建立连接(减少延迟)
2. 实现简单：无需维护连接状态
3. 头部开销显著小(8个字节，TCP是20个字节)
4. 没有拥塞控制：应用可以更好地控制发送时间和速率

## 用途
1. 流媒体应用——容忍丢失，速率敏感
2. DNS
3. SNMP
4. 在UDP上实现可靠数据传输
    - 在应用层增加可靠性机制
    - 应用特定的错误恢复机制

## UDP报文格式

|source port(16 bit) #|dest port(16 bit) #|
|-|-|
|length(16 bit)|checksum(16 bit)|
|application data|

## UDP校验和(checksum)
目的：检测UDP段在传输中是否发生错误(如位翻转)

发送方
- 将段的内容视为16-bit整数
- 校验和计算：计算所有整数的和，最高位进位加在和的后面，将得到的值按位取反，得到校验和
- 发送方将校验和放入校验和字段

接收方
- 计算收到段的校验和
- 将其与校验和字段进行对比
    - 不相等——检测出错误
    - 相等——没有检测出但是可能有错误

## 校验和计算示例
- 最高位进位必须被加到后面

&nbsp;&nbsp;&nbsp;&nbsp;1 1 1 0 0 1 1 0 0 1 1 0 </br>+ 
1 1 0 1 0 1 0 1 0 1 0 1
---
wraparound 

1 1 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1
---
sum

1 0 1 1 1 0 1 1 1 0 1 1 1 1 0 0
---
checksum

0 1 0 0 0 1 0 0 0 1 0 0 0 0 1 1
---